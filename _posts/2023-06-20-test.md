---
layout: post
title:  "test"
date:   2023-06-20
mathjax: true
---

We want the current state of selected cell to change. That is, if the cell's index in the input array is a 1 then the user selected that cell and we want the compute shader to change the cell's state (from a 0 to a 1, or from a 1 to a 0). And if the cell's index in the input array is a 0, then we want the current state to pass through the compute shader unchanged. 

in other words we want the follow behavior:

<div style="width:100px;">
| input state  | cell state in  | cell state out |
| :----------------: | :----------------: | :-------------------: |
| 1        |   1         | 0           |
| 1        |   0         | 1           |
| 0        |   1         | 1           |
| 0        |   0         | 0           |
</div>

And this is just the truth table of the exclusive-or \[xor\] operator. An expression ``` a ^ b ```, where ``` ^ ``` is xor, is true only when either ``` a ``` or ``` b ``` is true, but not both. So the compute shader can find the current state of the cell, and the current state of the input array, from the index, and then write the xor of those two states to the output buffer.

{% highlight rust %}
@group(0) @binding(0) var<uniform> grid: vec2f;

    @group(0) @binding(1) var<storage> cellStateIn: array<u32>;
    @group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;
    @group(0) @binding(3) var<storage, read> inputState: array<u32>;

    /* find the cell index. handle out of bounds by "wrapping" the index around  the grid */
    fn cellIndex(cell: vec2u) -> u32 {
        return (cell.y % u32(grid.y)) * u32(grid.x) +
            (cell.x % u32(grid.x));
      }
    
    fn cellActive(x: u32, y: u32) -> u32 {
        return cellStateIn[cellIndex(vec2(x, y))];
      }

    @compute @workgroup_size(16, 16)
    fn computeMain(@builtin(global_invocation_id) cell: vec3u){
        let i = cellIndex(cell.xy);

        /* inputState[i] xOr currentState[i] */
        cellStateOut[i] = inputState[i] ^ cellStateIn[i];
            
    }
{% endhighlight %}